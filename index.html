<!DOCTYPE html>
<html>
<head>
    <title>Radioactive Half-life Simulation</title>
    <style>
        body {
            background-color: #000000;
            color: #FFFFFF;
        }
        #penny-container {
            position: relative;
            width: 800px;
            height: 600px;
            border: 1px solid black;
            margin: 0 auto;
            background-color: #f0f0f0;
        }
        #penny-container img {
            position: absolute;
            width: 40px;
            height: 40px;
            cursor: grab;
        }
        #controls {
            text-align: center;
            margin-top: 20px;
        }
        #title, #penny-count {
            text-align: center;
        }
    </style>
</head>
<body>

<h1 id="title">Mr. Huddleston's Half-life Simulation</h1>
<p id="penny-count">Penny Count: 200</p>

<div id="penny-container">
    <!-- Pennies will be added here dynamically -->
</div>

<div id="controls">
    <button id="shake-button" enabled>Shake!</button>
    <button id="reset-button">Reset</button>
</div>

<script>
    var totalPennies = 200;
    var pennySize = 40; // Penny size in pixels
    var pennyContainer = document.getElementById('penny-container');
    var pennyCountDisplay = document.getElementById('penny-count');
    var zIndexCounter = 1; // To keep track of z-index

    function initializeSimulation() {
        // Clear the penny container
        pennyContainer.innerHTML = '';
        // Reset penny count and z-index counter
        totalPennies = 200;
        zIndexCounter = 1;
        pennyCountDisplay.textContent = 'Penny Count: ' + totalPennies;
        // Enable the 'Shake!' button
        document.getElementById('shake-button').disabled = false;
        // Create pennies in a grid pattern, all tails
        var cols = 20;
        var rows = 10;
        var x_start = 0;
        var y_start = (pennyContainer.clientHeight - (rows * pennySize)) / 2;
        for (var i = 0; i < totalPennies; i++) {
            var penny = document.createElement('img');
            penny.src = 'tails.webp';
            penny.dataset.side = 'tails';
            var col = i % cols;
            var row = Math.floor(i / cols);
            var x = x_start + col * pennySize;
            var y = y_start + row * pennySize;
            penny.style.left = x + 'px';
            penny.style.top = y + 'px';
            penny.style.zIndex = zIndexCounter;
            penny.onmousedown = startDrag;
            pennyContainer.appendChild(penny);
        }
    }

    var draggedPenny = null;
    var offsetX = 0;
    var offsetY = 0;

    function startDrag(event) {
        draggedPenny = event.target;
        zIndexCounter++;
        draggedPenny.style.zIndex = zIndexCounter;
        // Calculate the offset between the mouse position and the top-left corner of the penny
        offsetX = event.clientX - draggedPenny.getBoundingClientRect().left;
        offsetY = event.clientY - draggedPenny.getBoundingClientRect().top;
        document.addEventListener('mousemove', dragging);
        document.addEventListener('mouseup', endDrag);
        event.preventDefault();
    }

    function dragging(event) {
        var containerRect = pennyContainer.getBoundingClientRect();
        var x = event.clientX - containerRect.left - offsetX;
        var y = event.clientY - containerRect.top - offsetY;
        draggedPenny.style.left = x + 'px';
        draggedPenny.style.top = y + 'px';
    }

    function endDrag(event) {
        document.removeEventListener('mousemove', dragging);
        document.removeEventListener('mouseup', endDrag);
        var pennyRect = draggedPenny.getBoundingClientRect();
        var containerRect = pennyContainer.getBoundingClientRect();

        // Check if the penny is outside the container
        if (
            pennyRect.right < containerRect.left ||
            pennyRect.left > containerRect.right ||
            pennyRect.bottom < containerRect.top ||
            pennyRect.top > containerRect.bottom
        ) {
            if (draggedPenny.dataset.side === 'heads') {
                // Remove the penny from the container
                pennyContainer.removeChild(draggedPenny);
                // Update the penny count
                totalPennies--;
                pennyCountDisplay.textContent = 'Penny Count: ' + totalPennies;
                
                // Check if all remaining pennies are tails
                var pennies = pennyContainer.getElementsByTagName('img');
                var allTails = true;
                for (var i = 0; i < pennies.length; i++) {
                    if (pennies[i].dataset.side === 'heads') {
                        allTails = false;
                        break;
                    }
                }
                if (allTails) {
                    // Enable the 'Shake!' button
                    document.getElementById('shake-button').disabled = false;
                } else {
                    document.getElementById('shake-button').disabled = true;
                }
            } else {
                // If it's tails, snap back into container
                var x = Math.min(Math.max(0, parseFloat(draggedPenny.style.left)), pennyContainer.clientWidth - pennySize);
                var y = Math.min(Math.max(0, parseFloat(draggedPenny.style.top)), pennyContainer.clientHeight - pennySize);
                draggedPenny.style.left = x + 'px';
                draggedPenny.style.top = y + 'px';
            }
        } else {
            // Ensure the penny stays within the container bounds
            var x = Math.min(Math.max(0, parseFloat(draggedPenny.style.left)), pennyContainer.clientWidth - pennySize);
            var y = Math.min(Math.max(0, parseFloat(draggedPenny.style.top)), pennyContainer.clientHeight - pennySize);
            draggedPenny.style.left = x + 'px';
            draggedPenny.style.top = y + 'px';
        }
        draggedPenny = null;
    }

    function shakePennies() {
        var pennies = pennyContainer.getElementsByTagName('img');
        var shakeDuration = 2000; // milliseconds
        var shakeInterval = 100; // milliseconds between shakes
        var elapsed = 0;
        var shakeTimer = setInterval(function() {
            // Before shaking, set the pennies to new random sides
            for (var i = 0; i < pennies.length; i++) {
                var penny = pennies[i];
                var isHeads = Math.random() < 0.5;
                penny.src = isHeads ? 'heads.webp' : 'tails.webp';
                penny.dataset.side = isHeads ? 'heads' : 'tails';
                // Reset rotation
                penny.style.transform = '';
            }
            for (var i = 0; i < pennies.length; i++) {
                var penny = pennies[i];
                // Randomly change the position slightly
                var deltaX = ((Math.random()+Math.random())/2 - 0.5) * 30; // change in x between -15 and 15
                var deltaY = (Math.random() - 0.5) * 30; // change in y between -15 and 15
                var currentX = parseFloat(penny.style.left);
                var currentY = parseFloat(penny.style.top);
                var newX = currentX + deltaX;
                var newY = currentY + deltaY;
                // Ensure the penny stays within the container bounds
                newX = Math.min(Math.max(0, newX), pennyContainer.clientWidth - pennySize);
                newY = Math.min(Math.max(0, newY), pennyContainer.clientHeight - pennySize);
                penny.style.left = newX + 'px';
                penny.style.top = newY + 'px';
                // Optionally, add rotation for visual effect
                penny.style.transform = 'rotate(' + (Math.random() * 360) + 'deg)';
            }
            elapsed += shakeInterval;
            if (elapsed >= shakeDuration) {
                clearInterval(shakeTimer);
                
                // After shaking, disable the 'Shake!' button again
                document.getElementById('shake-button').disabled = true;
            }
        }, shakeInterval);
        // Check if all remaining pennies are tails
        var allTails = true;
        for (var i = 0; i < pennies.length; i++) {
            if (pennies[i].dataset.side === 'heads') {
                allTails = false;
                break;
            }
        }
        if (allTails) {
            // Enable the 'Shake!' button
            document.getElementById('shake-button').disabled = false;
        } else {
            document.getElementById('shake-button').disabled = true;
        }
    }

    function resetSimulation() {
        if (confirm('Are you sure you want to reset the simulation?')) {
            initializeSimulation();
        }
    }

    // Event listeners for buttons
    document.getElementById('shake-button').addEventListener('click', shakePennies);
    document.getElementById('reset-button').addEventListener('click', resetSimulation);

    // Initialize the simulation on page load
    initializeSimulation();
</script>

</body>
</html>
